{"ast":null,"code":"import React,{useState,useEffect,useContext}from\"react\";import{toast}from\"react-toastify\";import{useHistory}from\"react-router-dom\";import{makeStyles}from\"@material-ui/core/styles\";import Paper from\"@material-ui/core/Paper\";import Button from\"@material-ui/core/Button\";import IconButton from\"@material-ui/core/IconButton\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import EditIcon from\"@material-ui/icons/Edit\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import api from\"../../services/api\";import{i18n}from\"../../translate/i18n\";import ConfirmationModal from\"../../components/ConfirmationModal\";import toastError from\"../../errors/toastError\";import{isArray}from\"lodash\";import{AddCircle,TextFields}from\"@mui/icons-material\";import{CircularProgress,Grid,Stack}from\"@mui/material\";import{Can}from\"../../components/Can\";import{AuthContext}from\"../../context/Auth/AuthContext\";import CampaignModalPhrase from\"../../components/CampaignModalPhrase\";const reducer=(state,action)=>{if(action.type===\"LOAD_CAMPAIGNS\"){const campaigns=action.payload;const newCampaigns=[];if(isArray(campaigns)){campaigns.forEach(campaign=>{const campaignIndex=state.findIndex(u=>u.id===campaign.id);if(campaignIndex!==-1){state[campaignIndex]=campaign;}else{newCampaigns.push(campaign);}});}return[...state,...newCampaigns];}if(action.type===\"UPDATE_CAMPAIGNS\"){const campaign=action.payload;const campaignIndex=state.findIndex(u=>u.id===campaign.id);if(campaignIndex!==-1){state[campaignIndex]=campaign;return[...state];}else{return[campaign,...state];}}if(action.type===\"DELETE_CAMPAIGN\"){const campaignId=action.payload;const campaignIndex=state.findIndex(u=>u.id===campaignId);if(campaignIndex!==-1){state.splice(campaignIndex,1);}return[...state];}if(action.type===\"RESET\"){return[];}};const useStyles=makeStyles(theme=>({mainPaper:{flex:1,borderRadius:12,padding:theme.spacing(1),overflowY:\"scroll\",...theme.scrollbarStyles}}));const CampaignsPhrase=()=>{const classes=useStyles();const history=useHistory();const{user}=useContext(AuthContext);const[loading,setLoading]=useState(true);const[pageNumber,setPageNumber]=useState(1);const[hasMore,setHasMore]=useState(false);const[selectedCampaign,setSelectedCampaign]=useState(null);const[deletingCampaign,setDeletingCampaign]=useState(null);const[campaignModalOpen,setCampaignModalOpen]=useState(false);const[confirmModalOpen,setConfirmModalOpen]=useState(false);const[searchParam,setSearchParam]=useState(\"\");const[confirmOpen,setConfirmOpen]=useState(false);const[deletingContact,setDeletingContact]=useState(null);const[campaignflows,setCampaignFlows]=useState([]);const[ModalOpenPhrase,setModalOpenPhrase]=useState(false);const[campaignflowSelected,setCampaignFlowSelected]=useState();const handleDeleteCampaign=async campaignId=>{try{await api.delete(\"/flowcampaign/\".concat(campaignId));toast.success(\"Frase deletada\");getCampaigns();}catch(err){toastError(err);}};const getCampaigns=async()=>{setLoading(true);await api.get(\"/flowcampaign\").then(res=>{setCampaignFlows(res.data.flow);}).finally(()=>{setLoading(false);});};const onSaveModal=()=>{getCampaigns();};const handleScroll=e=>{if(!hasMore||loading)return;const{scrollTop,scrollHeight,clientHeight}=e.currentTarget;if(scrollHeight-(scrollTop+100)<clientHeight){}};useEffect(()=>{getCampaigns();},[]);return/*#__PURE__*/React.createElement(MainContainer,null,/*#__PURE__*/React.createElement(ConfirmationModal,{title:deletingCampaign&&\"\".concat(i18n.t(\"campaigns.confirmationModal.deleteTitle\"),\" \").concat(deletingCampaign.name,\"?\"),open:confirmModalOpen,onClose:setConfirmModalOpen,onConfirm:()=>handleDeleteCampaign(deletingContact.id)},i18n.t(\"campaigns.confirmationModal.deleteMessage\")),/*#__PURE__*/React.createElement(CampaignModalPhrase,{open:ModalOpenPhrase,onClose:()=>setModalOpenPhrase(false),FlowCampaignId:campaignflowSelected,onSave:onSaveModal}),/*#__PURE__*/React.createElement(MainHeader,null,/*#__PURE__*/React.createElement(Grid,{style:{width:\"99.6%\"},container:true},/*#__PURE__*/React.createElement(Grid,{xs:12,sm:8,item:true},/*#__PURE__*/React.createElement(Title,null,\"Campanhas\")),/*#__PURE__*/React.createElement(Grid,{xs:12,sm:4,item:true},/*#__PURE__*/React.createElement(Grid,{spacing:2,container:true},/*#__PURE__*/React.createElement(Grid,{xs:6,sm:6,item:true}),/*#__PURE__*/React.createElement(Grid,{xs:6,sm:6,item:true},/*#__PURE__*/React.createElement(Button,{fullWidth:true,variant:\"contained\",onClick:()=>{setCampaignFlowSelected();setModalOpenPhrase(true);},color:\"primary\",style:{textTransform:\"none\"}},/*#__PURE__*/React.createElement(Stack,{direction:\"row\",gap:1},/*#__PURE__*/React.createElement(AddCircle,null),\"Campanha\"))))))),/*#__PURE__*/React.createElement(Paper,{className:classes.mainPaper,variant:\"outlined\",onScroll:handleScroll},/*#__PURE__*/React.createElement(Stack,null,/*#__PURE__*/React.createElement(Grid,{container:true,style:{padding:\"8px\"}},/*#__PURE__*/React.createElement(Grid,{item:true,xs:4},\"Nome\"),/*#__PURE__*/React.createElement(Grid,{item:true,xs:4,align:\"center\"},\"Status\"),/*#__PURE__*/React.createElement(Grid,{item:true,xs:4,align:\"end\"},i18n.t(\"contacts.table.actions\"))),/*#__PURE__*/React.createElement(React.Fragment,null,!loading&&campaignflows.map(flow=>/*#__PURE__*/React.createElement(Grid,{container:true,key:flow.id,sx:{padding:\"8px\",borderRadius:4,marginTop:0.5}},/*#__PURE__*/React.createElement(Grid,{item:true,xs:4},/*#__PURE__*/React.createElement(Stack,{justifyContent:\"center\",height:\"100%\",style:{color:\"#252525\"}},/*#__PURE__*/React.createElement(Stack,{direction:\"row\"},/*#__PURE__*/React.createElement(TextFields,null),/*#__PURE__*/React.createElement(Stack,{justifyContent:\"center\",marginLeft:1},flow.name)))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:4,align:\"center\",style:{color:\"#252525\"}},/*#__PURE__*/React.createElement(Stack,{justifyContent:\"center\",height:\"100%\"},flow.status?\"Ativo\":\"Desativado\")),/*#__PURE__*/React.createElement(Grid,{item:true,xs:4,align:\"end\"},/*#__PURE__*/React.createElement(IconButton,{size:\"small\",onClick:()=>{setCampaignFlowSelected(flow.id);setModalOpenPhrase(true);}},/*#__PURE__*/React.createElement(EditIcon,{style:{color:\"#252525\"}})),/*#__PURE__*/React.createElement(Can,{role:user.profile,perform:\"contacts-page:deleteContact\",yes:()=>/*#__PURE__*/React.createElement(IconButton,{size:\"small\",onClick:e=>{setConfirmModalOpen(true);setDeletingContact(flow);}},/*#__PURE__*/React.createElement(DeleteOutlineIcon,{style:{color:\"#252525\"}}))})))),loading&&/*#__PURE__*/React.createElement(Stack,{justifyContent:\"center\",alignItems:\"center\",minHeight:\"50vh\"},/*#__PURE__*/React.createElement(CircularProgress,null))))));};export default CampaignsPhrase;","map":null,"metadata":{},"sourceType":"module"}