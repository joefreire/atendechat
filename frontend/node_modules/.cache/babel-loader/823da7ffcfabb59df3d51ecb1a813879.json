{"ast":null,"code":"import{Button,Dialog,DialogActions,DialogContent,DialogTitle,Grid,IconButton,makeStyles,Modal,Typography}from\"@material-ui/core\";import{CloseOutlined,FontDownload,ImportContacts}from\"@material-ui/icons\";import React,{useState}from\"react\";import{FaDownload}from\"react-icons/fa\";import*as XLSX from'xlsx';import{array}from\"yup\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import{i18n}from\"../../translate/i18n\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexWrap:\"wrap\"},dialogImport:{minWidth:500},iFile:{display:\"none\"},lbFile:{border:\"dashed\",borderWidth:2,padding:18,cursor:\"pointer\",display:\"inline-block\",width:\"70%\"},btnWrapper:{position:\"relative\"},iconPlanilha:{marginRight:10},cLbFile:{textAlign:\"center\"},titleLb:{textTransform:\"uppercase\",fontWeight:\"bolder\",marginTop:10},iconDownload:{color:theme.palette.primary.main,fontSize:18},cModal:{paddingTop:50,paddingBottom:50},cSuccessContacts:{backgroundColor:\"#AAEE9C80\",padding:10,borderRadius:8,marginTop:30},cErrorContacts:{backgroundColor:\"#DD011B40\",padding:10,borderRadius:8,marginTop:30},titleResult:{fontWeight:\"bolder\"},cCloseModal:{textAlign:\"end\"}}));const ImportContactsModal=props=>{const classes=useStyles();const{open,onClose}=props;const[isSubmitting,setIsSubmitting]=useState(false);const[nameFile,setNameFile]=useState('');const[listcontacts,setListContacts]=useState([]);const[successUpload,setSuccessUpload]=useState([]);const[errorUpload,setErrorUpload]=useState([]);const handleNewFile=e=>{const file=e.target.files[0];if(!file)return;setNameFile(file.name);readXlsx(file);};const readXlsx=file=>{const reader=new FileReader();reader.onload=e=>{const ab=e.target.result;const wb=XLSX.read(ab,{type:'array'});const wsname=wb.SheetNames[0];const ws=wb.Sheets[wsname];const data=XLSX.utils.sheet_to_json(ws);setListContacts(data);};reader.readAsArrayBuffer(file);};const handleSaveListContacts=async()=>{setIsSubmitting(true);try{const{data:responseData}=await api.post(\"/contacts/upload\",listcontacts);setSuccessUpload(responseData.newContacts);setErrorUpload(responseData.errorBag);}catch(e){toastError(e);}finally{setIsSubmitting(false);}};const handleDownloadModel=()=>{window.location.href=\"\".concat(window.location.protocol,\"//\").concat(window.location.host,\"/import-contatos.xlsx\");};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Dialog,{open:open,maxWidth:\"sm\",fullWidth:true,scroll:\"paper\"},/*#__PURE__*/React.createElement(DialogTitle,null,/*#__PURE__*/React.createElement(Grid,{container:true,alignItems:\"center\"},/*#__PURE__*/React.createElement(Grid,{item:true,xs:6},i18n.t(\"contactImportModal.title\")),/*#__PURE__*/React.createElement(Grid,{item:true,xs:6,className:classes.cCloseModal},/*#__PURE__*/React.createElement(IconButton,{onClick:onClose},/*#__PURE__*/React.createElement(CloseOutlined,null))))),/*#__PURE__*/React.createElement(DialogContent,{dividers:true,className:classes.cModal},/*#__PURE__*/React.createElement(\"div\",{className:classes.cLbFile},/*#__PURE__*/React.createElement(\"label\",{className:classes.lbFile,htmlFor:\"i-import-contacts\"},/*#__PURE__*/React.createElement(FaDownload,{className:classes.iconDownload}),/*#__PURE__*/React.createElement(\"div\",{className:classes.titleLb},i18n.t(\"contactImportModal.labels.import\")),nameFile!==''&&/*#__PURE__*/React.createElement(\"div\",null,\"(\",nameFile,\" - \",listcontacts.length,\" \",i18n.t(\"contactImportModal.labels.result\"),\")\")),/*#__PURE__*/React.createElement(\"input\",{onChange:handleNewFile,className:classes.iFile,type:\"file\",accept:\".xlsx\",id:\"i-import-contacts\"})),successUpload.length>0&&/*#__PURE__*/React.createElement(\"div\",{className:classes.cSuccessContacts},/*#__PURE__*/React.createElement(Typography,{className:classes.titleResult},i18n.t(\"contactImportModal.labels.added\"),\":\"),successUpload.map(contact=>/*#__PURE__*/React.createElement(\"div\",null,contact.contactId,\" | \",contact.contactName,\" - \",i18n.t(\"contactImportModal.labels.savedContact\")))),errorUpload.length>0&&/*#__PURE__*/React.createElement(\"div\",{className:classes.cErrorContacts},/*#__PURE__*/React.createElement(Typography,{className:classes.titleResult},i18n.t(\"contactImportModal.labels.errors\"),\":\"),/*#__PURE__*/React.createElement(\"ul\",null,errorUpload.map(contact=>/*#__PURE__*/React.createElement(\"li\",null,contact.contactName,\" - \",contact.error.message))))),/*#__PURE__*/React.createElement(DialogActions,null,/*#__PURE__*/React.createElement(Button,{color:\"primary\",disabled:isSubmitting,variant:\"outlined\",onClick:handleDownloadModel},/*#__PURE__*/React.createElement(ImportContacts,{className:classes.iconPlanilha}),i18n.t(\"contactImportModal.buttons.download\")),/*#__PURE__*/React.createElement(Button,{color:\"primary\",disabled:isSubmitting,variant:\"contained\",className:classes.btnWrapper,onClick:handleSaveListContacts},i18n.t(\"contactImportModal.buttons.import\")))));};export default ImportContactsModal;","map":null,"metadata":{},"sourceType":"module"}